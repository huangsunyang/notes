#### 标准光照模型

##### Phong模型

- 环境光
- 自发光
- 漫反射光
  - Lambert定律 $c_{diffuse}=c_{light}*m_{diffuse}*max(0,n·l)$
  - $m_{diffuse}$漫反射颜色
  - 反射光线强度与光源方向`l`和法线方向`n`的夹角成正比，即用点积计算

- 高光反射
  - $c_{specular}=c_{light}*m_{specular}*max(0,v·r)^{m_{gloss}}$
  - `v`为反射光方向，`r`为视角方向，$m_{gloss}$为光泽度

##### Blinn-Phong模型的优化

- 对高光反射的优化，避免计算`r`，而使用`normalize(v + l)`

##### 逐像素还是逐顶点

- 逐像素 `Phong shading`计算量更大
- 逐顶点 `Gouraud shading`对于非线性情况模拟不好

- 实践结果逐像素效果更高

#### 纹理基础

##### 纹理采样

- 在顶点着色器中，通过材质的缩放/偏移计算得到每个顶点的纹理坐标
- 在片元着色器中，对纹理用坐标位置采样，获得`albedo`，也就是反射率。反射率在人的角度来看也就是物体显示出的颜色

##### 凹凸映射 `bump Mapping`

- 高度纹理：用来模拟表面位移
- 法线纹理：直接存储表面法线
  - 模型空间
  - 切线空间，以顶点为原点，切线方向为x轴，原法线方向为z轴

##### 渐变纹理 `Ramp Texture`

- 本质上页就是将lamber计算得出的点积值映射到纹理上，得到阶梯式的亮度值
- 暂时不清楚有材质纹理的时候如何处理。对于单一颜色的物体能够得到较好的卡通效果

#### 透明效果

##### 渲染顺序

- 背景->不透明物体->透明度测试->透明度混合->叠加效果

##### 深度测试

- 只能渲染全透明或者不透明，利用透明纹理检测像素点，丢弃不能通过透明度测试的像素点
- 不用关闭深度写入，但是需要注意渲染顺序

##### 透明度混合

- `Blend SrcFactor DstFactor`命令将用这两个参数混合片元产生的颜色和颜色缓存中的颜色
  - `BlendOp BlendOperation`可以用不同的操作符对上述两个颜色进行叠加
- 透明物体的绘制顺序非常重要，应该在不透明物体绘制完后绘制
  - 通常会关闭深入写入，如果能保证透明物体从后向前绘制，打开也没事
  - 如果绘制顺序出了问题，关闭深入写入会错的不那么明显。

##### 平面化半透明效果

- 即只渲染Front面的半透明效果
- 开启深入写入，但不输出颜色。渲染第一个pass
- 得到正确的深度值后渲染第二个pass

##### 双面渲染的透明效果

- 透明度测试下只需要关闭Cull即可
- 透明度混合下通常会用两个pass
  - 先`Cull Front`渲染第一个pass，`Cull Back`渲染第二个pass